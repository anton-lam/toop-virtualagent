import { verify } from 'jsonwebtoken';

export const contentText = 
`I stood for a moment outside its closed door, for I could hear some one stirring; he moved something, let fall something else; I felt that the room was not empty,
that there must be somebody there. But it was only the freshly lighted fire beginning to burn. It could not keep quiet, it kept shifting its faggots about, and very clumsily. 
I entered the room; it let one roll into the fender and set another smoking. And even when it was not moving, like an ill-bred person it made noises all the time,
which, from the moment I saw the flames rising, revealed themselves to me as noises made by a fire, although if I had been on the other side of a wall I should have thought 
that they came from some one who was blowing his nose and walking about. I sat down in the room and waited. Liberty hangings and old German stuffs of the eighteenth century
managed to rid it of the smell that was exhaled by the rest of the building, a coarse, insipid, mouldy smell like that of stale toast. It was here, in this banning room, 
that I could have dined and slept with a calm and happy mind Saint-Loup seemed almost to be present by reason of the text-books which littered his table, between his photographs,
among which I could make out my own and that of the Duchesse de Guermantes, by the light of the fire which had at length grown accustomed to the grate, and, 
like an animal crouching in an ardent, noiseless, faithful watchfulness, let fall only now and then a smouldering log which crumbled into sparks, or licked with a tongue of
flame the sides of the chimney. I heard the tick of Saint-Loup's watch, which could not be far away. This tick changed its place every moment 'for I could not see the watch; 
it seemed to come from behind, from in front of me, from my right, from my left, sometimes to die away as though at a great distance. 

Suddenly I caught sight of the watch on the table. Then I heard the tick in a fixed place from which it did not move again. That is to say, I thought I heard it at this place; 
I did not hear it there; I saw it there, for sounds have no position in space. Or rather we associate them with movements, and in that way they serve the purpose of warning us 
of those movements, of appearing to make them necessary and natural. Certainly it happens commonly enough that a sick man whose ears have been stopped with cotton-wool ceases 
to hear the noise of a fire such as was crackling at that moment in Saint-Loup's fireplace, labouring at the formation of brands and cinders, which it then lets fall into the fender, 
nor would he hear the passage of the tramway-cars whose music took its flight, at regular intervals, over the Grand'place of Doncières. Let the sick man then read a book, and the 
pages will turn silently before him, as though they were moved by the fingers of a god. The dull thunder of a bath which is being filled becomes thin, faint and distant as the 
twittering of birds in the sky. 

The withdrawal of sound, its dilution, take from it all its power to hurt us; driven mad a moment ago by hammer-blows which seemed to be shattering the ceiling
above our head, it is with a quiet delight that we now gather in their sound, light, caressing, distant, like the murmur of leaves playing by the roadside with the 
passing breeze. We play games of patience with cards which we do not hear, until we imagine that we have not touched them, that they are moving of their own accord, and, 
anticipating our desire to play with them, have begun to play with us. And in this connexion we may ask ourselves whether, in the case of love (to which indeed we may add 
the love of life and the love of fame, since there are, it appears, persons who are acquainted with these latter sentiments), we ought not to act like those who, when a noise 
disturbs them, instead of praying that it may cease, stop their ears; and, with them for our pattern, bring our attention, our defensive strength to bear on ourselves, give 
ourselves as an objective to capture not the 'other person' with whom we are in love but our capacity for suffering at that person's hands.

To return to the problem of sounds, we have only to thicken the wads which close the aural passages, and they confine to a pianissimo the girl who has just been playing a 
boisterous tune overhead; if we go farther, and steep the wad in grease, at once the whole household must obey its despotic rule; its laws extend even beyond our portals.
Pianissimo is not enough; the wad instantly orders the piano to be shut, and the music lesson is abruptly ended; the gentleman who was walking up and down in the room above 
breaks off in the middle of his beat; the movement of carriages and tramways is interrupted as though a Sovereign were expected to pass. And indeed this attenuation of
sounds sometimes disturbs our slumbers instead of guarding them. Only yesterday the incessant noise in our ears, by describing to us in a continuous narrative all that 
was happening in the street and in the house, succeeded at length in making us sleep, like a boring book; to-night, through the sheet of silence that is spread over our sleep a
shock, louder than the rest, manages to make itself heard, gentle as a sigh, unrelated to any other sound, mysterious; and the call for an explanation which it emits is sufficient to awaken us. 
Take away for a moment from the sick man the cotton-wool that has been stopping his ears and in a flash the full daylight, the sun of sound dawns afresh, dazzling him, is born again 
in his universe; in all haste returns the multitude of exiled sounds; we are present, as though it were the chanting of choirs of angels, at the resurrection of the voice. The
empty streets are filled for a moment with the whirr of the swift, consecutive wings of the singing tramway-cars. In the bedroom itself, the sick man has created, not, 
like Prometheus, fire, but the sound of fire. And when we increase or reduce the wads of cotton-wool, it is as though we were pressing alternately one and 
the other of the two pedals with which we have extended the resonant compass of the outer world.

Only there are also suppressions of sound which are not temporary. The man who has grown completely deaf cannot even heat a pan of milk by his bedside, but he must keep an eye open to watch, 
on the tilted lid, for the white, arctic reflexion, like that of a coming snowstorm, which is the warning sign which he is wise to obey, by cutting off (as Our Lord bade the waves be still) 
the electric current; for already the swelling, jerkily climbing egg of boiling milk-film is reaching its climax in a series of sidelong movements, has filled and set bellying the drooping 
sails with which the cream has skimmed its surface, sends in a sudden storm a scud of pearly substance flying overboard—sails which the cutting off of the current, if the electric storm is 
hushed in time, will fold back upon themselves and let fall with the ebbing tide, changed now to magnolia petals. But if the sick man should not be quick enough in taking the necessary precautions, 
presently, when his drowned books and watch are seen barely emerging from the milky tide, he will be obliged to call the old nurse who, though he be himself an eminent statesman or a famous writer, 
will tell him that he has no more sense than a child of five. At other times in the magic chamber, between us and the closed door, a person who was not there a moment ago makes his appearance; it is 
a visitor whom we did not hear coming in, and who merely gesticulates, like a figure in one of those little puppet theatres, so restful for those who have taken a dislike to the spoken tongue. 
And for this totally deaf man, since the loss of a sense adds as much beauty to the world as its acquisition, it is with ecstasy that he walks now upon an earth grown almost an Eden, in which sound 
has not yet been created. The highest waterfalls unfold for his eyes alone their ribbons of crystal, stiller than the glassy sea, like the cascades of Paradise. As sound was for him before his deafness 
the perceptible form in which the cause of a movement was draped, objects moved without sound seemed to be being moved also without cause; deprived of all resonant quality, they shew a spontaneous activity, 
seem to be alive. They move, halt, become alight of their own accord. Of their own accord they vanish in the air like the winged monsters of prehistoric days. In the solitary and unneighboured home of the 
deaf man the service which, before his infirmity was complete, was already shewing an increased discretion, was being carried on in silence, is now assured him with a sort of surreptitious deftness, by mutes, 
as at the court of a fairy-tale king. And, as upon the stage, the building on which the deaf man looks from his window—be it barracks, church, or town hall—is only so much scenery. If one day it should fall to 
the ground, it may emit a cloud of dust and leave visible ruins; but, less material even than a palace on the stage, though it has not the same exiguity, it will subside in the magic universe without letting 
the fall of its heavy blocks of stone tarnish, with anything so vulgar as sound, the chastity of the prevailing silence.`


/**
 * gets read more content of a passage from proust
 * @param ctx 
 */
export const getContent = async ctx => {

    ctx.status = 200;
    
    //if token is valid, then return entire content
    //TODO: move it out of content.ts so it can be used for other endpoints
    try{
        ctx.state.token = verify(ctx.request.token, "wem39fka");
        ctx.body = { text: contentText} ;
    }catch (err) {
        //missing/invalid token = return partial content
        ctx.body = {text: `${contentText.slice(0, contentText.length / 2)}...`};
    }
}